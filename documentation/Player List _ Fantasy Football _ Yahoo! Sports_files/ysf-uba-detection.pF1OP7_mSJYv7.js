
YUI.add('ysf-uba-detection',function(Y){Y.namespace('Fantasy');var w=window;Y.Fantasy.UBADetection={init:function(adBlockConfig){var cookieName=adBlockConfig.cookieName;var adblock=Y.Cookie.get('thamba');var thamba=adblock==='1'||adblock==='2';var shouldCheckPosition=adBlockConfig.positions&&adBlockConfig.positions.length?true:false;var cookieDuration=(adBlockConfig.cookieDuration||7)*24*60;var pixelDetectUrl=adBlockConfig.pxGifURL?adBlockConfig.pxGifURL:'https://www.yahoo.com/px.gif';function detectABP(daTrk){var DPba=new function(){this.detect=function(px,callback){var detected=false;var checksRemain=2;var error1=false;var error2=false;if(typeof callback!="function")return;px+="?ch=*&rn=*";function beforeCheck(callback,timeout){if(checksRemain==0||timeout>1E3)callback(checksRemain==0&&detected);else setTimeout(function(){beforeCheck(callback,timeout*2)},timeout*2)}function checkImages(){if(--checksRemain)return;detected=!error1&&error2}var random=Math.random()*11;var img1=new Image;img1.onload=checkImages;img1.onerror=function(){error1=true;checkImages()};img1.src=px.replace(/\*/,1).replace(/\*/,random);var img2=new Image;img2.onload=checkImages;img2.onerror=function(){error2=true;checkImages()};img2.src=px.replace(/\*/,2).replace(/\*/,random);beforeCheck(callback,250)}};DPba.detect(pixelDetectUrl,function(usesABP){if(usesABP){var expires=new Date();expires.setMinutes(expires.getMinutes()+cookieDuration);daTrk='2';Y.Cookie.set(cookieName,daTrk,{expires:expires,domain:location.hostname,path:'/'});}
if((!thamba&&daTrk!=='0')&&w.rapidInstance&&w.rapidInstance.beaconEvent){w.rapidInstance.beaconEvent("datrk",{pl1:daTrk});}});}
function ubDetection(){var decoyId='my-ads';var decoyNode=document.createElement('div');decoyNode.setAttribute('id',decoyId);decoyNode.innerHTML=decoyId;document.body.appendChild(decoyNode);var decoyNodeIns=document.querySelector('#'+decoyId);if(decoyNodeIns&&decoyNodeIns.offsetHeight===0){decoyNodeIns.remove();return true;}
decoyNodeIns.remove();if(shouldCheckPosition){var positions=adBlockConfig.positions;var adposNodeCount=0;var hidenPosNodeCount=0;for(var position of positions){var adposNode=document.querySelector('#'+position);if(adposNode){adposNodeCount+=1;if(adposNode.offsetHeight===0){hidenPosNodeCount+=1;}}}
if(adposNodeCount>0&&adposNodeCount===hidenPosNodeCount){return true;}}
return false;}
function initABDetection(){var daTrk='0';var cExpiry=0;var expires=new Date();var abSelector=document.getElementById('advertisement-thamba');if(!abSelector){daTrk='1';cExpiry=cookieDuration;}
if(adBlockConfig.enableUBDetection){var isUBActive=ubDetection();if(isUBActive){daTrk='1';cExpiry=cookieDuration;}}
expires.setMinutes(expires.getMinutes()+cExpiry);if((thamba&&daTrk==='0')||(!thamba&&daTrk==='1')){Y.Cookie.set(cookieName,daTrk,{expires:expires,domain:location.hostname,path:'/'});}
if(adBlockConfig.enableABPDetection){detectABP(daTrk);}}
setTimeout(initABDetection,adBlockConfig.detectionTimeout||300);}};},'',{requires:['cookie']});