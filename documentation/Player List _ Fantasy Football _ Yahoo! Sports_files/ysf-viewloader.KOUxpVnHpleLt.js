
YUI.add('ysf-viewloader',function(Y){var ViewLoaderProto;function InvalidHrefAttrException(el){var id=el.get('id');this.message='Element '+id+' does not have a valid data-href attribute set';this.name='InvalidHrefAttrException';}
function ViewLoader(cfg){ViewLoader.superclass.constructor.apply(this,arguments);}
ViewLoader.NAME='viewloader';ViewLoader.ATTRS={'el':{value:null,setter:function(el){return Y.one(el);}},'href':{value:null},'triggerHandler':{value:function(e,obj){var el=obj.get('el');obj.viewportStateAction(el);}},'eventType':{value:['scroll','touchmove']},'callbackObj':{value:{'success':function(cId,response){var respObj=this.parseResponse(cId,response),content,contentHTML;if(this.getErrors(cId)){Y.log(this.getErrors(cId),'warn','yfa-mod-viewload');}else{contentHTML=Y.Fantasy.Mod.cleanupHtml(respObj.content);content=Y.Node.create(contentHTML);this.processNewModule(content);this.destroy();}},'failure':function(cId,response){Y.log('failure handler called on connection '+cId,'error','yfa-module');}}}};ViewLoaderProto={initializer:function(cfg){this.createViewLoader();},createViewLoader:function(){var el=this.get('el');if(el){this.parseElAttrs(el);this.viewportStateAction(el);}},parseElAttrs:function(el){var href=el.getData('href');if(Y.Lang.isString(href)){this.set('href',href);}else{throw new InvalidHrefAttrException(el);}},viewportStateAction:function(el){var inViewport=this.isElInViewport(el);if(inViewport){this.inViewportHandler();}},isElInViewport:function(el){var viewportRegion=el.get('viewportRegion');return el.inRegion(viewportRegion,true);},inViewportHandler:function(){var el=this.get('el'),href=this.get('href');this.fetch(el,href);if(this.get('activeConnection')){this.detachTriggers();}},processNewModule:function(content){var el=this.get('el'),newMod;this.decorateContent(content);this.destroyOldModule(el);el.replace(content);if(content.hasClass('Mod')){newMod=new Y.Fantasy.Mod({'el':content,'triggers':content});newMod.on('yfamodule:displayudpate',function(e){Y.Fantasy.PostLoad.initImages(newMod.get('id'));});}
this.set('el',null);},decorateContent:function(content){if(content.hasClass('Mod')){content.addClass('Fade-in');}},destroyOldModule:function(el){var oldMod;oldMod=Y.Fantasy.Mod.getModule(el);if(oldMod){oldMod.destroy();}}};Y.extend(ViewLoader,Y.Fantasy.XHR,ViewLoaderProto);Y.namespace('Fantasy');Y.Fantasy.ViewLoader=ViewLoader;},'0.0.1',{'requires':['ysf-xhr','yfa-module']});