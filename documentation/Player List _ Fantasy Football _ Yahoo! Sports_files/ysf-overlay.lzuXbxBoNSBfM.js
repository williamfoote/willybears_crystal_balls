
YUI.add('ysf-overlay',function(Y){var body,overlayMap={},D_OVERLAY_NAME='data-overlay-name',EV_OVERLAY_OPEN='ysfoverlay:open',EV_OVERLAY_OPENED='ysfoverlay:overlayopened',EV_OVERLAY_CLOSE='ysfoverlay:close',EV_OVERLAY_CLOSED='ysfoverlay:overlayclosed',D_OVERLAY_WIDTH='data-overlay-width',D_OVERLAY_POPULATE='data-overlay-populate';function delegateClickHandler(e){var overlayName=this.getAttribute(D_OVERLAY_NAME),overlayWidth=this.getAttribute(D_OVERLAY_WIDTH),populate=this.getAttribute(D_OVERLAY_POPULATE)||null,target=this;if(overlayName){Y.fire(EV_OVERLAY_OPEN,{'overlayname':overlayName,'overlaywidth':overlayWidth,'populate':populate,'trigger':target});}
e.preventDefault();}
function setOverlayAlign(overlay){var a=Y.WidgetPositionAlign,selector=overlay.get('srcNode').getData('overlay-align-sel'),overlayType='center',position=true,setAlignment=false;overlayType=overlay.get('srcNode').getData('overlay-align-position')||'center';switch(overlayType){case'topLeft':position={node:selector,points:[a.TL,a.TL]};break;case'topRight':position={node:selector,points:[a.TR,a.TR]};break;case'topCenter':position={node:selector,points:[a.TC,a.TC]};break;case'center':overlay.set('centered',selector);setAlignment=true;break;default:setAlignment=true;break;}
if(!setAlignment){overlay.set('align',position);}}
function createOverlay(overlayCfg){var overlayName=overlayCfg.name,overlayEl,overlayObj,overlayHideFunc,overlayWidth,overlayHeight,overlayClickmask,overlayConstrainPage;overlayEl=Y.one('[data-overlay-name='+overlayName+'].yfa-overlay, [data-overlay-name='+overlayName+'].Overlay');if(overlayEl){overlayWidth=overlayCfg.width||overlayEl.getData('overlay-width')||'500px';if(Y.one('body').hasClass('Phone')){overlayWidth='100%';}
if(Y.one('body').hasClass('Tablet')&&overlayEl.getData('tablet-overlay-width')){overlayWidth=overlayEl.getData('tablet-overlay-width');}
overlayHeight=overlayCfg.height||overlayEl.getData('overlay-height')||'';overlayClickmask=(overlayEl.getData('overlay-noclickmask'))?false:true;overlayConstrainPage=(overlayEl.getData('overlay-constrainpage')==='false')?false:true;overlayObj=new Y.Overlay({srcNode:overlayEl,render:false,visible:false,width:overlayWidth,height:overlayHeight,centered:true,constrain:Y.one('.Page, #yui-main')&&overlayConstrainPage?'.Page, #yui-main':true,zIndex:210000,modal:true,plugins:[Y.Plugin.OverlayModal,Y.Plugin.OverlayKeepAligned,{fn:Y.Plugin.OverlayAutohide,cfg:{focusedOutside:false,clickedOutside:false}}]});if(overlayEl.hasAttribute('data-overlay-align-sel')){setOverlayAlign(overlayObj);}
overlayObj.render();overlayMap[overlayName]=overlayObj;overlayHideFunc=function(e){var t=e.target;if(t.hasClass('yfa-overlay-close-no-halt')){e.preventDefault();}else{e.halt();}
overlayObj.hide();};overlayEl.delegate('click',overlayHideFunc,'.ysf-overlay-close, .yfa-overlay-close, .Overlay-close');if(overlayClickmask){Y.one('body').delegate('click',overlayHideFunc,'.yui3-overlay-mask');}
overlayObj.after('visibleChange',function(e){var triggeredBy=overlayObj.get('srcNode').getData('triggeredBy');if(e.newVal===true){Y.fire(EV_OVERLAY_OPENED,{'overlayname':overlayName,'triggeredBy':triggeredBy});}else{Y.fire(EV_OVERLAY_CLOSED,{'overlayname':overlayName});}});return overlayMap[overlayName];}}
function getOverlay(overlayCfg){var overlay=overlayMap[overlayCfg.name]||createOverlay(overlayCfg);if(!overlay._stackNode.inDoc()){overlayMap[overlayCfg.name]=createOverlay(overlayCfg);}
return overlayMap[overlayCfg.name];}
function openOverlayHandler(e){var overlayName=e.overlayname,overlayWidth=e.overlaywidth,overlay,overlayCfg={},populate,trigger=e.trigger||null;try{if(Y.Lang.isString(e.populate)){populate=Y.JSON.parse(e.populate);}else{populate={};}}catch(err){populate={};}
overlayCfg.name=overlayName;overlayCfg.width=overlayWidth;overlay=getOverlay(overlayCfg);if(overlay){Y.Object.each(populate,function(val,key){overlay.get('srcNode').one(key).set('value',val);});overlay.get('srcNode').setData('triggeredBy',trigger);overlay.show();}}
function closeOverlayHandler(e){var overlayName=e.overlayname,overlay;overlay=overlayMap[overlayName];if(overlay){overlay.hide();}}
function findOverlay(overlayName){return overlayMap[overlayName];}
Y.publish(EV_OVERLAY_OPEN,{defaultFn:openOverlayHandler,emitFacade:true});Y.publish(EV_OVERLAY_CLOSE,{defaultFn:closeOverlayHandler,emitFacade:true});Y.publish(EV_OVERLAY_OPENED,{emitFacade:true,broadcast:2});Y.publish(EV_OVERLAY_CLOSED,{emitFacade:true,broadcast:2});body=Y.one('body');body.addClass('yui3-skin-sam');Y.namespace('Fantasy.Overlay');Y.Fantasy.Overlay.delegateClickHandler=delegateClickHandler;Y.Fantasy.Overlay.findOverlay=findOverlay;body.delegate('click',delegateClickHandler,'.yfa-overlay-trigger, .Overlay-trigger');},'0.1',{requires:['event-custom','node','event','overlay','widget-anim','gallery-overlay-extras','gallery-outside-events']});